C251 COMPILER V5.60.0,  PID                                                                27/03/24  17:34:22  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE PID
OBJECT MODULE PLACED IN .\Out_File\PID.obj
COMPILER INVOKED BY: D:\keil5\keil5_MDK\keil5_MDK_32\C251\BIN\C251.EXE ..\CODE\PID.c XSMALL INTR2 WARNINGLEVEL(3) BROWSE
                    - INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\USER
                    -\inc;..\USER\src) DEBUG PRINT(.\Out_File\PID.lst) OBJECT(.\Out_File\PID.obj) 

stmt  level    source

    1          #include "zf_tim.h"
    2          #include "isr.h"
    3          #include <string.h>
    4          #include <stdio.h>
    5          #include "common.h"
    6          #include "Motor.h"
    7          #include "ZF_PWM.h"
    8          #include "PID.h"
    9          
   10          
   11          //***********************************************************位置式PID***********************************
             -*************************//
   12          
   13          PID_InitTypeDef Left_Wheel_PID;
   14          PID_InitTypeDef Right_Wheel_PID;
   15          PID_InitTypeDef Turn_PID;
   16          
   17          void PID_Init(PID_InitTypeDef *PID_Struct, float Kp, float Ki, float Kd,float Out_Limit, float Integral_L
             -imit)                //PID初始化
   18          {
   19   1              PID_Struct->Kp = Kp;
   20   1              PID_Struct->Ki = Ki;
   21   1              PID_Struct->Kd = Kd;
   22   1              
   23   1              PID_Struct->Err = 0;
   24   1              PID_Struct->Err_last = 0;
   25   1      
   26   1              PID_Struct->PID_Out = 0;
   27   1              PID_Struct->Out_Limit = Out_Limit;
   28   1              PID_Struct->Integral_Limit = Integral_Limit;
   29   1      }
   30          
   31          
   32          void PID_Calculate(PID_InitTypeDef *PID_Struct, float Exp_Val, float Act_Val)           //PID计算
   33          {
   34   1              PID_Struct->Err = Exp_Val-Act_Val;              //err值为期望偏差与当前偏差的差值       
   35   1              PID_Struct->Integral += PID_Struct->Err;                //误差值累加    
   36   1                      //积分限幅
   37   1              if(PID_Struct->Integral > PID_Struct->Integral_Limit){
   38   2                      PID_Struct->Integral = PID_Struct->Integral_Limit;
   39   2              } else if(PID_Struct->Integral < -PID_Struct->Integral_Limit){
   40   2                      PID_Struct->Integral = -PID_Struct->Integral_Limit;
   41   2              }
   42   1              PID_Struct->PID_Out = PID_Struct->Err * PID_Struct->Kp + 
   43   1                                                                      PID_Struct->Integral * PID_Struct->Ki + //计算总输出量
   44   1                                                                              (PID_Struct->Err - PID_Struct->Err_last)*(PID_Struct->Kd);
   45   1              
   46   1              //输出限幅
   47   1              if(PID_Struct->PID_Out > PID_Struct->Out_Limit){
   48   2                      PID_Struct->PID_Out = PID_Struct->Out_Limit;
   49   2              } else if(PID_Struct->PID_Out < -PID_Struct->Out_Limit){
   50   2                      PID_Struct->PID_Out = -PID_Struct->Out_Limit;
   51   2              }
   52   1              PID_Struct->Err_last = PID_Struct->Err;         //更新上一次err
   53   1      }
   54          
   55          
C251 COMPILER V5.60.0,  PID                                                                27/03/24  17:34:22  PAGE 2   

   56          
   57          
   58          //***********************************************************增量式PID***********************************
             -***************//
   59          
   60          
   61          PID_Incremental Turn;
   62          PID_Incremental Left_Wheel;
   63          PID_Incremental Right_Wheel;
   64          
   65          PID_Incremental PID_Incremental_Init(float Kp, float Ki, float Kd,float Out_Limit)
   66          {
   67   1              PID_Incremental pid;
   68   1              pid.Kp = Kp;
   69   1              pid.Ki = Ki;
   70   1              pid.Kd = Kd;
   71   1              
   72   1          pid.error = 0;
   73   1          pid.last_error = 0;
   74   1          pid.last_last_error = 0;
   75   1          pid.last_out = 0;
   76   1          pid.out = 0;
   77   1          pid.outmax = Out_Limit;
   78   1          pid.outmin = -Out_Limit;
   79   1              return pid;
   80   1      }
   81          
   82          
   83          float PID_Incremental_Calc(PID_Incremental *pid, float setpoint, float input_value)
   84          {
   85   1              float derivative;
   86   1              float output_increment;
   87   1          pid->last_last_error = pid->last_error;
   88   1          pid->last_error = pid->error;
   89   1          pid->error = setpoint - input_value;
   90   1          derivative = (pid->error - 2 * pid->last_last_error + pid->last_last_error);
   91   1          output_increment = pid->Kp * (pid->error - pid->last_error) + pid->Ki * pid->error + pid->Kd * deriva
             -tive;
   92   1      
   93   1          pid->out += output_increment;
   94   1      
   95   1          if(pid->out > pid->outmax){
   96   2                      pid->out = pid->outmax;
   97   2              } else if(pid->out < pid->outmin){
   98   2                      pid->out = pid->outmin;
   99   2              }
  100   1      
  101   1      
  102   1          pid->last_out = pid->out;
  103   1      
  104   1          return pid->out;
  105   1      }
  106          
  107          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       652     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       228         72
  bit size             =    ------     ------
C251 COMPILER V5.60.0,  PID                                                                27/03/24  17:34:22  PAGE 3   

  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
